Fix dirfd crashing on macOS